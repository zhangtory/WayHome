# WayHome 回家之路

## 有啥用？
   不论是在家中还是出门在外，都可以直接访问家中的WEB、网盘等服务。

## 用前要准备啥？
1. 公网ip。  
     如果没有打电话让电信分配一个即可。
2. 家中光猫or路由器做端口转发。  
     一般来说电信屏蔽了80和443等端口，所以我们需要通过其他端口做转发，映射到内网的80端口。
3. 公网服务器。  
     很显然，你需要一台服务器部署该程序。

## 怎么用？
1. 部署server端。  
   clone源码，修改application.properties中的secretKey，随机一个字符串即可。  
   默认8848端口，可以自行修改。  
   然后使用maven打成jar包，放到公网服务器上nohup java -jar运行即可。   
   可以直接将8848端口暴露到公网，也可以使用nginx等做转发。
2. 部署client端。   
   clone源码，修改home.properties中的配置信息，其中home.secretKey需要和服务器端一致。   
   然后使用maven打成jar包，放到内网服务器上nohup java -jar运行即可。   
3. 浏览器访问。   
   访问公网服务器的/go地址，即可重定向到家中的地址上。eg.https://公网域名orIP:port/go   
  
## 啥原理？
  程序分为server端和client端。  
  server端部署在公网服务器上，接收来自client的消息，并将client的地址信息记录下来。  
  当浏览器请求访问回家之路时，根据请求的IP地址和client消息的IP地址对比，如果来自同一公网地址，则重定向到内网的IP地址上，反之重定向到公网的IP地址上。  
  client端部署在家中内网的服务器上，每隔一定时间与server端同步一次信息，该信息包括了通讯协议、内网ip、外网ip、端口信息等。  

## 和花生壳、frp、Ngrok有啥关系
  没关系。  
  原理不一样，WayHome是直接将地址重定向到家中的IP地址上，之后的所有流量WayHome都不会参与。  
  而花生壳、frp、Ngrok等内网穿透软件，所有的流量都会经过他们。
  
## WayHome有啥优点
  我写这个程序，是为了访问家中的HomeAssistant，从而控制家中的智能家居。  
  很显然，如果只用内网，那么出门在外我就不能控制家中的智能家居。  
  如果只使用花生壳、frp、Ngrok等内网穿透软件，那么在家的时候，就会明显感觉到延迟。  
  当然，我们可以在家的时候使用内网地址，出门在外使用内网穿透，但是两个地址切换不方便。  
  所以WayHome的优点就出来了，通过统一的网址，你在家的时候，自动使用内网地址；在外的时候，自动使用外网地址。
  
